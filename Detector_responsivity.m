function [Responsivity] = Detector_responsivity(P_Total,Vdc_PD,PD_width,lambda)
wi_M = PD_width;
Vac_M2 = Vdc_PD;
lambda_M = lambda;
Power_M = P_Total;
Pq = 1.60217663e-19;
Ph = 6.62607015e-34;
Pc = 299792458;
np = 1.0e24;
nn = 1.0e24;
ni = 1.2e20;
vbi = 0.320;
ege = 2*8.854187817e-12*16.0/Pq;
Vac = Vac_M2;
vjun = -Vac + vbi;
wi = wi_M;
if (vjun >= 0)
    xp = (-2.0*np*wi + sqrt(4*np*np*wi*wi - 4.0*np*(ni*wi*wi-vjun*ege))) / (2*np);
    xi = 0.0;
    if (xp < 0)
        xp = 0.0;
        xi = wi - sqrt(ege*vjun/ni);
    end
    xn = (ni*(wi-xi) + np*xp) / nn;
    actw = xp + (wi-xi) + xn;
else
    actw = 0.0;
end
actw_M2 = actw;
detrespte=1.752e6;
mmdet=0.0;
actw = actw_M2;
wi = wi_M;
lambda = lambda_M;
Power = Power_M;
x = 10*log10(Power*1e3);
y = Vac_M2;
z = wi*1e9;
lambda = max(lambda, 1.2499e-6);
wfactor= ((Pq*lambda)/(Ph*Pc));
dwi= wi-0.7e-6;
actwte = min(0.5e-6, actw)*(1- 0.29e6*abs(dwi));
qE_TE = detrespte*(1.0+0.10*mmdet)*(actwte);
Resp_TE = qE_TE*wfactor;
p00 = 0.000528559702829012*z+0.837163823442489;
p10 = 0.000110689917428079*z-0.0261698607592752;
p01 = 0.000547682635403255*z-0.173468755726762;
p20 = 1.03474330485936e-05*z-0.00113946401413909;
p11 = 0.000106337657889389*z-0.0173009050018921;
p02 = 0.000282773267841930*z-0.0805763027883054;
p30 = 5.94995031867770e-07*z+3.14886493520986e-05;
p21 = 7.80374019659429e-06*z+0.000714024523236414;
p12 = 5.15823180765314e-05*z-0.00320601766735964;
p03 = 5.35762936187922e-05*z-0.0137639166843916;
p40 = 2.67613362736369e-08*z+3.65813720659067e-06;
p31 = 2.43409134719264e-07*z+0.000111623455278730;
p22 = 3.02229525745460e-06*z+0.000841903171936712;
p13 = 9.34170606780657e-06*z+0.000152541027224142;
p50 = 7.12735523160096e-10*z+5.22989955433119e-08;
p41 = 4.25708767684603e-09*z+3.12281422540814e-06;
p32 = 3.51520831502758e-08*z+3.44860643893603e-05;
p23 = 4.64275960081692e-07*z+0.000169248996086310;
CF_R = p00+p10.*x+p01.*y+p20.*x.^2+p11.*x.*y+p02.*y.^2+p30.*x.^3+p21.*x.^2.*y+p12.*x.*y.^2+p03.*y.^3+p40.*x.^4+p31.*x.^3.*y+p22.*x.^2.*y.^2+p13.*x.*y.^3+p50.*x.^5+p41*x.^4.*y+p32*x.^3.*y.^2+p23*x.^2.*y.^3;
Responsivity = Resp_TE./CF_R;
end
